<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>
<body>
<h1>Dashboard</h1>
<div id="content"></div>

<script>
  // Function to fetch and display content based on user role
  function loadContent() {
    fetch('/api/users/current')
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to fetch current user details');
              }
              return response.json();
            })
            .then(user => {
              // Check if user object is empty or does not contain expected fields
              if (!user || !user.id || !user.username || !user.email || !user.role) {
                throw new Error('Invalid user details received');
              }

              // Continue processing user details and loading content based on role
              let content = '';
              if (user.role === 'admin') {
                content = '<h2>Admin Dashboard</h2>';
                // Fetch and display content for admin users (e.g., table of all users)
                fetch('/api/users/all')
                        .then(response => response.json())
                        .then(users => {
                          content += '<table border="1">';
                          content += '<tr><th>ID</th><th>Username</th><th>Email</th><th>Role</th></tr>';
                          users.forEach(u => {
                            content += `<tr><td>${u.id}</td><td>${u.username}</td><td>${u.email}</td><td>${u.role}</td></tr>`;
                          });
                          content += '</table>';
                          document.getElementById('content').innerHTML = content;
                        })
                        .catch(error => {
                          console.error('Error fetching users:', error.message);
                          // Handle error gracefully, e.g., display error message to user
                        });
              } else {
                content = '<h2>User Dashboard</h2>';
                // Fetch and display content for non-admin users (e.g., table of matches)
                // Implement logic to fetch matches here
                content += '<p>Table of matches goes here...</p>';
                document.getElementById('content').innerHTML = content;
              }
            })
            .catch(error => {
              console.error('Error fetching current user details:', error.message);
              // Handle error gracefully, e.g., display error message to user
            });
  }

  // Call loadContent function when the page loads
  window.onload = loadContent;
</script>
</body>
</html>
