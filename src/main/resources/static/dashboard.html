<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
</head>
<body>
<h1>Dashboard</h1>
<div id="content"></div>
<button onclick="redirectToUpdate()">Update Information</button>

<script>
  // Function to fetch and display content based on user role
  function loadContent() {
    fetch('/api/users/current')
            .then(response => {
              if (!response.ok) {
                throw new Error('Failed to fetch current user details');
              }
              return response.json();
            })
            .then(user => {
              // Check if user object is empty or does not contain expected fields
              if (!user || !user.id || !user.username || !user.email || !user.role) {
                throw new Error('Invalid user details received');
              }

              // Continue processing user details and loading content based on role
              let content = '';
              if (user.role === 'admin') {
                content = '<h2>Admin Dashboard</h2>';
                fetch('/api/users/all')
                        .then(response => response.json())
                        .then(users => {
                          content += '<table border="1"><tr><th>ID</th><th>Username</th><th>Email</th><th>Role</th></tr>';
                          users.forEach(u => {
                            content += `<tr><td>${u.id}</td><td>${u.username}</td><td>${u.email}</td><td>${u.role}</td></tr>`;
                          });
                          content += '</table>';
                          document.getElementById('content').innerHTML = content;
                        })
                        .catch(error => {
                          console.error('Error fetching users:', error.message);
                        });
                content += '<button onClick="redirectToUserManagement()">User Management</button>';
                content += '<button onClick="redirectToMatchExport()">Matches</button>';
              } else {
                getMatchesByRole(user.role);
              }
            })
            .catch(error => {
              console.error('Error fetching current user details:', error.message);
            });
  }

  function getMatchesByRole() {
    // Assume there's an API endpoint that returns matches based on the user's role
    fetch(`/api/users/byRole`)
            .then(response => response.json())
            .then(matches => {
              let content = '<h2>User Dashboard</h2>';
              if (matches.length > 0) {
                content += '<table border="1"><tr><th>ID</th><th>Tournament ID</th><th>Player 1 ID</th><th>Player 2 ID</th><th>Referee ID</th><th>Match Date</th><th>Score</th></tr>';
                matches.forEach(match => {
                  content += `<tr>
                      <td>${match.id}</td>
                      <td>${match.tournamentId}</td>
                      <td>${match.player1Id}</td>
                      <td>${match.player2Id}</td>
                      <td>${match.refereeId}</td>
                      <td>${match.matchDate}</td>
                      <td>${match.score}</td>
                    </tr>`;
                });
                content += '</table>';
              } else {
                content += '<p>No matches found.</p>';
              }
              document.getElementById('content').innerHTML = content;
            })
            .catch(error => {
              console.error('Error fetching matches:', error.message);
              document.getElementById('content').innerHTML = '<h2>User Dashboard</h2><p>Error loading matches.</p>';
            });
  }

  // Redirect function for update page
  function redirectToUpdate() {
    window.location.href = '/update.html';
  }

  // Redirect function for user management page
  function redirectToUserManagement() {
    window.location.href = '/user_management.html';
  }

  // Redirect function for match export page
  function redirectToMatchExport() {
    window.location.href = '/match_export.html';
  }

  // Call loadContent function when the page loads
  window.onload = loadContent;
</script>
</body>
</html>
